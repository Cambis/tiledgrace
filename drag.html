<!DOCTYPE html>
<html>
 <head>
     <meta charset="UTF-8">
     <title>Gratch</title>
     <style type="text/css">
        #codearea {
           width: 500px;
           height: 500px;
           background: #ddd;
           position: relative;
           float: left;
           overflow: auto;
        }
        .tile.operator {
           background: #9b9;
           border: 2px outset #060;
        }
        .tile.comparison-operator {
           background: #44d;
           border: 2px outset #00b;
        }
        .tile.request {
            background: #b99;
            border: 2px outset #600;
        }
        .tile.vardec {
           background: #c44;
           border: 2px outset #c00;
        }
        .tile.var {
           background: #eaa;
           border: 2px outset #c00;
        }
        .tile.assign {
           background: #ccc;
           border: 2px outset #888;
        }
        .tile.number {
           background: #8c8;
           border: 2px outset #080;
        }
        .tile.string {
           background: #cec;
           border: 2px outset #0c0;
        }
        .tile.string input {
            color: #080;
        }
        .tile.if {
           background: #88c;
           border: 2px outset #008;
           flex-direction: column;
           align-items: flex-start;
           -webkit-flex-direction: column;
           -webkit-align-items: flex-start;
        }
        .tile.while {
           background: #88c;
           border: 2px outset #008;
           flex-direction: column;
           align-items: flex-start;
           -webkit-flex-direction: column;
           -webkit-align-items: flex-start;
        }
        .tile.if > div, .tile.while > div {
            display: inline-flex;
            display: -webkit-inline-flex;
            align-items: center;
            -webkit-align-items: center;
        }
        .tile.print {
           background: #cc8;
           border: 2px outset #880;
        }
        .tile {
           padding: 1px;
           width: auto;
           height: auto;
           display: inline-flex;
           display: -webkit-inline-flex;
           float: left;
           position: absolute;
           white-space: nowrap;
           align-items: center;
           -webkit-align-items: center;
           transition: opacity 0.5s;
        }
        .tile span {
            display: inline-flex;
            display: -webkit-inline-flex;
        }
        .tile input {
           border: none;
        }
        .tile input[type=text] {
            font-family: monospace;
        }
        .selected {
           z-index: 999;
           opacity: 0.5;
           cursor: default;
        }
        .hole {
           padding: 1px;
           background: #aaa;
           display: inline-flex;
           display: -webkit-inline-flex;
           width: auto;
           min-height: 12px;
        }
        .hole:empty {
            min-width: 2em;
        }
        #toolbox {
            background: #ccf;
            float:left;
            height: 500px;
            width: 150px;
        }
        #toolbox .tile {
            position: static;
            clear: both;
        }
        .tile .op, .tile .cmpop {
            display:inline-flex;
            display: -webkit-inline-flex;
            padding-left: 4px;
            padding-right: 4px;
            font-weight: bold;
        }
        #gracecode {
            float: left;
            width: 200px;
            height: 500px;
        }
        .tile.bottom-join-target {
            border-bottom-color: yellow;
            border-bottom-style: solid;
        }
        .hole.multi {
           flex-direction: column;
           -webkit-flex-direction: column;
           align-items: flex-start;
           display: flex;
           display: -webkit-flex;
        }
        #bin {
            position: absolute;
            top: 0;
            right: 0;
            width: 50px;
            height: 50px;
            background: red;
        }
        .tile.over-bin {
            opacity: 0.25;
            transition: opacity 0s;
        }
        .tile.over-bin, .over-bin .tile, .over-bin .hole {
            background: red;
            border-color: red;
        }
        #codearea.shrink {
            background: white;
        }
        .shrink .tile, .shrink .hole {
            padding: 0;
            border: 0 !important;
            background: none;
            min-width: 0;
        }
        .shrink input, .shrink select {
            background: none;
            border: none;
        }
     </style>
 </head>
 <body>
     <div id="codearea">
         <div id="bin"></div>
     </div>
     <div id="toolbox">
         <div class="tile vardec"><span style="margin-right: 4px; color: blue;">var</span><input type="text" value="" size="1" class="variable-name"><span style="margin-left: 4px; margin-right: 4px; color: #687687;">:=</span><div class="hole"></div></div>
         <div class="tile var"><select name="var"></select></div>
         <div class="tile assign"><div class="hole"></div><span style="margin-left: 4px; margin-right: 4px; color: #687687;">:=</span><div class="hole"></div></div>
         <div class="tile operator"><div class="hole number"></div><div class="op">+</div><div class="hole number"></div></div>
         <div class="tile comparison-operator"><div class="hole number"></div><div class="cmpop">==</div><div class="hole number"></div></div>
         <div class="tile number"><input type="text" value="0" size="3" ></div>
         <div class="tile string">"<input type="text" value="Hello, world!" size="13" >"</div>
         <div class="tile request"><div class="hole"></div><span>.</span><input type="text" size="5"></div>
         <div class="tile if"><div><span>if (</span><div class="hole"></div><span>) then {</span></div><div style="padding-left: 2ex;"><div class="hole multi"></div></div><div><span style="display:inline;">}</span></div></div>
         <div class="tile if else if-else"><div><span>if (</span><div class="hole"></div><span>) then {</span></div><div style="padding-left: 2ex;"><div class="hole multi"></div></div><div><span style="display:inline;">} else {</span></div><div style="padding-left: 2ex;"><div class="hole multi"></div></div><div><span>}</span></div></div>
         <div class="tile while"><div><span>while {</span><div class="hole"></div><span>} do {</span></div><div style="padding-left: 2ex;"><div class="hole multi"></div></div><div><span style="display:inline;">}</span></div></div>
         <div class="tile print"><span style="margin-right: 4px;">print </span><div class="hole"></div></div>
     </div>
     <textarea id="gracecode"></textarea><br />
     <textarea id="stdout_txt" style="clear:both;" cols="100" rows="5"></textarea><input type="button" onclick="go()" value="Run"><input type="button" onclick="generateJSON()" value="Save">
     <br /><textarea id="stderr_txt" style="clear:both;" cols="100" rows="5"></textarea>
     <script type="text/javascript" src="main.js"></script>
     <script type="text/javascript" src="json.js"></script>
     <script type="text/javascript" src="minigrace.js"></script>
     <script type="text/javascript">
        var getCode = function() {
            return document.getElementById('gracecode').value;
        }

        // Setup stderr.
        minigrace.stderr_write = function(value) {
            var stderr = document.getElementById("stderr_txt");
            stderr.value += value;
            stderr.scrollTop = stderr.scrollHeight;
        };

        // Setup stdout.
        minigrace.stdout_write = function(value) {
            var stdout = document.getElementById("stdout_txt");
            stdout.value += value;
            stdout.scrollTop = stdout.scrollHeight;
        };

        function go() {
            document.getElementById('stderr_txt').value = "";
            document.getElementById('stdout_txt').value = "";
            minigrace.modname = "main";
            minigrace.compilerun(getCode());
        }
        if (localStorage.getItem("autosave-json")) {
            loadJSON(localStorage.getItem("autosave-json"));
        }
    </script>
 </body>
</html>
