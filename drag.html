<!DOCTYPE html>
<html>
 <head>
     <meta charset="UTF-8">
     <title>Gratch</title>
     <link rel="stylesheet" type="text/css" href="style.css">
 </head>
 <body>
     <div id="codearea">
         <div id="bin">&#59177;</div>
     </div>
     <div id="toolbox">
         <div class="tile vardec"><span style="margin-right: 1ex; color: blue;">var</span><input type="text" value="" size="1" class="variable-name"><span style="margin-left: 1ex; margin-right: 1ex; color: #687687;">:=</span><div class="hole"></div></div>
         <div class="tile var"><span class="var-name"></span></div>
         <div class="tile assign"><div class="hole"></div><span style="margin-left: 1ex; margin-right: 1ex; color: #687687;">:=</span><div class="hole"></div></div>
         <div class="tile operator"><div class="hole number"></div><div class="op">+</div><div class="hole number"></div></div>
         <div class="tile comparison-operator"><div class="hole number"></div><div class="cmpop">==</div><div class="hole number"></div></div>
         <div class="tile number"><input type="text" value="0" size="3" ></div>
         <div class="tile string">"<input type="text" value="Hello, world!" size="13" >"</div>
         <div class="tile request"><div class="hole"></div><span>.</span><input type="text" size="5"></div>
         <div class="tile if"><div><span>if (</span><div class="hole"></div><span>) then {</span></div><div class="indent"><div class="hole multi"></div></div><div><span style="display:inline;">}</span></div></div>
         <div class="tile if else if-else"><div><span>if (</span><div class="hole"></div><span>) then {</span></div><div class="indent"><div class="hole multi"></div></div><div><span style="display:inline;">} else {</span></div><div class="indent"><div class="hole multi"></div></div><div><span>}</span></div></div>
         <div class="tile while"><div><span>while {</span><div class="hole"></div><span>} do {</span></div><div class="indent"><div class="hole multi"></div></div><div><span style="display:inline;">}</span></div></div>
         <div class="tile print"><span style="margin-right: 4px;">print </span><div class="hole"></div></div>
         <div class="tile forward dialect-request some-dialects only-dialect-logo"><span class="method-name">forward</span>(<div class="hole"></div>)</div>
         <div class="tile turnRight dialect-request some-dialects only-dialect-logo"><span class="method-name">turnRight</span>(<div class="hole"></div>)</div>
         <div class="tile turnLeft some-dialects only-dialect-logo dialect-request"><span class="method-name">turnLeft</span>(<div class="hole"></div>)</div>
         <div class="tile lineColorAssign some-dialects only-dialect-logo dialect-request"><span class="method-name" style="margin-right: 1ex;">lineColor :=</span><div class="hole"></div></div>
         <div class="tile some-dialects only-dialect-logo constant" data-name="blue">blue</div>
         <div class="tile some-dialects only-dialect-logo constant" data-name="red">red</div>
         <div class="tile some-dialects only-dialect-logo constant" data-name="green">green</div>
         <div class="tile some-dialects only-dialect-logo constant" data-name="black">black</div>
         <div class="tile method"><div><span style="margin-right: 1ex; color: blue;">method</span><input type="text" value="" size="5" />(<input type="text" value="" size="1" class="variable-name" />) {</div><div class="indent"><div class="hole multi"></div></div><div>}</div></div>
         <div class="tile selfcall"><input type="text" size="5" />(<div class="hole"></div>)</div>
     </div>
     <canvas id="standard-canvas" width="250" height="500"></canvas>
     <br />
     <select id="dialect" onchange="changeDialect()">
         <option value="">Standard
         <option value="logo">Turtle graphics
     </select>
     <input type="button" onclick="go()" value="Run">
     <input type="button" onclick="generateJSON()" value="Save">
     <input type="button" onclick="loadSave()" value="Load">
     <input type="button" onclick="toggleShrink()" value="Code View">
     <br />
     <textarea id="stdout_txt" style="clear:both;" cols="100" rows="5"></textarea>
     <br /><textarea id="stderr_txt" style="clear:both;" cols="100" rows="5"></textarea><br />
     <textarea id="gracecode" cols="100" rows="10"></textarea><br />
     <script type="text/javascript" src="main.js"></script>
     <script type="text/javascript" src="json.js"></script>
     <script type="text/javascript" src="minigrace.js"></script>
     <script type="text/javascript" src="turtle.js"></script>
     <script type="text/javascript" src="logo.js"></script>
     <script type="text/javascript">
        var getCode = function() {
            return document.getElementById('gracecode').value;
        }

        // Setup stderr.
        minigrace.stderr_write = function(value) {
            var stderr = document.getElementById("stderr_txt");
            stderr.value += value;
            stderr.scrollTop = stderr.scrollHeight;
        };

        // Setup stdout.
        minigrace.stdout_write = function(value) {
            var stdout = document.getElementById("stdout_txt");
            stdout.value += value;
            stdout.scrollTop = stdout.scrollHeight;
        };

        function go() {
            generateCode();
            document.getElementById('stderr_txt').value = "";
            document.getElementById('stdout_txt').value = "";
            minigrace.modname = "main";
            minigrace.compilerun(getCode());
        }
        if (window.location.hash) {
            var obj = loadJSON(decodeURIComponent((atob(window.location.hash.substring(1)))));
            history.replaceState(obj, "", generateHash(obj));
        } else if (localStorage.getItem("autosave-json")) {
            var obj = loadJSON(localStorage.getItem("autosave-json"));
            history.replaceState(obj, "", generateHash(obj));
        }
var gctCache = {
    'logo': "modules:\n StandardPrelude\npath:\n logo\nclasses:\npublic:\n red\n green\n blue\n black\n lineWidth\n lineWidth:=\n lineColor\n lineColor:=\n angle\n angle:=\n forward\n turnRight\n turnLeft\n atModuleEnd\nconfidential:\nfresh-methods:\n"
};
    </script>
    <div id="code_txt_real"></div>
    <script src="ace/ace.js"></script>
    <script src="ace/mode-grace.js" type="text/javascript" charset="utf-8"></script>
    <script>
        if (ace) {
           document.getElementById('code_txt_real').style.display = 'block';
           var editor = ace.edit("code_txt_real");
           var GraceMode = require("ace/mode/grace").Mode;
           editor.getSession().setMode(new GraceMode());
           editor.setBehavioursEnabled(false);
           editor.setHighlightActiveLine(true);
           editor.setShowFoldWidgets(false);
           editor.setShowPrintMargin(false);
           editor.getSession().setUseSoftTabs(true);
           editor.getSession().setTabSize(4);
           editor.setFontSize('16px');
           editor.setReadOnly(true);
           editor.commands.bindKeys({"ctrl-l":null, "ctrl-shift-r":null, "ctrl-r":null, "ctrl-t":null})
           var ctr = document.getElementById('code_txt_real');
           ctr.style.height = document.getElementById('codearea').clientHeight + 'px';
           ctr.style.width = (document.getElementById('codearea').clientWidth) + 'px';
           ctr.style.position = 'absolute';
           ctr.style.top = codearea.offsetTop + 'px';
           ctr.style.left = codearea.offsetLeft + 'px';
           ctr.style.visibility = 'hidden';
           // Get code from ace editor.
           //var getCode = function() {
           //    return editor.getValue();
           //}
        }
    </script>
    <div id="acknowledgements"><a href="https://github.com/mwh/minigrace">Minigrace</a> is distributed under the GNU GPL version 3. <a href="http://www.entypo.com/">Entypo</a> pictograms by Daniel Bruce.</div>
 </body>
</html>
